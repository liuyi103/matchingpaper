%File: formatting-instruction.tex
\documentclass[letterpaper]{article}
\usepackage{ijcai15}
\usepackage{times}
\usepackage{url}
\usepackage{helvet}
\usepackage{courier}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{balance}
\usepackage{amsmath}
\usepackage{xcolor}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{proposition}{Proposition}
\newenvironment{proof}{{Proof:}}{\hfill\rule{2mm}{2mm}}
\newenvironment{mechanism}{Mechanism}{\hfill\rule{2mm}{2mm}}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{lemma}{Lemma}
\newtheorem{property}{Property}

\title {OptOrder: optimum serial dictatorship in stochastic matching}
\author {Someone}
 \begin{document}
% The file aaai.sty is the style file for AAAI Press
% proceedings, working notes, and technical reports.
%

\maketitle
\begin{abstract}
This paper studies a simplified version of stochastic matching proposed in \cite{chen2009approximating}.
Previous study want to find the optimal policy for a matching system to maximize the cardinality of a matching.
In that setting, an agent may reject the assigned candidate (with a certain probability) and stay in the market or leave.
Finding the optimum policy to match meets great difficulty mainly from two aspects.
First, there is no evidence that the optimal policy can be expressed in polynomial space.
Second, collecting the acceptance ratio of each pair usually incurs considerable costs.

To express a policy efficiently and solve the optimum solution efficiently, we choose serial dictatorship and consider the case where the acceptance ratios are identical for each pair.
This paper aims to give an algorithm with a graph and the acceptance ratio as input and outputs a optimum order for serial dictatorship.
We first describe a straightforward integer linear programming with $O(|E|^4)$ entries.
Then, we reduce the number of entries to $O(|E|^2)$ by an important observation.
Finally, in the experimental part, we compare methods to solve even larger graphs.

\end{abstract}

\section{Introduction}

Motivated by applications like kidney exchange and online dating, \cite{chen2009approximating} defines stochastic matching.
They show a greedy algorithm with 0.25 approximation compared to the optimal algorithm.
The approximation ratio was improved by \cite{adamczyk2011improved,costello2012stochastic}.
\cite{goel2012matching} 
\cite{feldman2009online}

The current setting faces two main drawbacks to prevent it from practical use.

First, to know the exact probability of a prob being accepted is difficult.
Typically, in order to know the exact probabilities, the market needs to collect many data and conduct careful analyses on historical data.
It is worthy in important markets like kidney exchange market~\cite{dickerson2013failure,dickerson2015futurematch}.
However, in many less important market, collecting acceptance ratios is quite costly and unworthy.
Similar to online dating problem, let us consider a friend recommendation problem.
Someone (called Alice) has many friends, $x$ of them are single boys and $y$ are single girls.
Alice wants to introduce boys to girls for marriage.
She wants to maximize the number of matched couples.
Every boy or girl has some requirements that must be satisfied.
However, even though a boy and a girl satisfy each other's requirements, they may still not be willing to match.
In this case, it is hard and costly for Alice to survey the acceptance ratio of each pair.
Similar problem also appear in other applications like roommate problem~\cite{roth1982incentive}, but never serious considered as far as we know.

Second, as mentioned above, most study focus on giving worst case guarantees, compared both to the optimal solution and the offline optimum. 
The main difficulty preventing people to desire the optimum solution is that the optimal solution maybe not able to be expressed in polynomial space.
To solve the stochastic matching problem in practical, there is no evidence that the existing algorithms can work well enough.

In this paper, a simplified setting of stochastic matching is considered, which can still be utilized to solve many real life applications.
We assume that all the edges have the same acceptance ratio.
This assumption avoid the difficulty in surveying the acceptance probabilities and provides an essential condition for our algorithm.
As for the expressiveness of the solution, we improve it by serial dictatorship.
Although, serial dictatorship may reduce the expected number of matched agents, our experimental results demonstrate that the influence is not big.
With the solution, anyone can conduct the matching without any further help of a computer. 
One only needs $O(1)$ computation in average for each prob.
We are going to release our work as an open source tool. 
With the help of this tool, anyone is able make precise decisions for stochastic matching problems around themselves. 

The following part of this paper is organized as follows. Section 2 defines the serial dictatorship and show some fundamental good properties of it. Section 3 shows the construction of the integer linear programming step by step and prove its correctness. Section 4 explores methods to expand our algorithm to larger graphs. Section 5 shows our experimental results. Section 6 concludes this paper.


\section{The setting}

Our problem can be modeled in an undirected graph $G=(V,E)$, $V=\{v_1,v_2,\ldots,v_n\}$ denotes the set of agents. $e_{ij}\in E$ denotes an edge between $v_i$ and $v_j$.
The goal of the matching is to maximize cardinality. Each time, the system prob a pair of agents $v_i$ and $v_j$ with an edge $e_{ij}$ connecting them. 
(1) If $v_i$ and $v_j$ accept to match with each other with $p$ probability, both of the two agents are removed from the market.
(2) If $v_i$ and $v_j$ do not accept with $1-p$ probability, the system knows that they cannot match and removes $e_{ij}$ from $E$.

\section{ESD algorithm}

To maximize the number of matched agents, we apply edge serial dictatorship algorithm (ESD).
The outline is described In Algorithm \ref{alg:esd}.

\begin{algorithm}
	\caption{ESD algorithm}
	\label{alg:esd}
	\begin{algorithmic}[1]
		\Require
		A sorted array of $E$, denoted by $S=s_1,s_2,\ldots,s_m$ and the set of vertices $V$.
		\Ensure A set of disjoint edges $A$, such that each two agents connected by an edge in $A$ agree to match. 
		\State $A=\emptyset$
		\For $i=1,2,\ldots,m$
		\State Let $v_x$ and $v_y$ be the two agents connected by $s_i$
		\If $v_x\in V$ and $v_y\in V$
		\State Prob $v_x$ and $v_y$ whether they agree to match with each other.
		\If Both $v_x$ and $v_y$ accept to match
		\State Put $s_i$ into $A$
		\State Remove $v_x$ and $v_y$ from $V$
		\EndIf
		\EndIf
		\EndFor
		\State Outputs $A$ as the set of matched edges.
	\end{algorithmic}
\end{algorithm}

Algorithm \ref{alg:esd} is quite straightforward. The system just picks edges one by one in some order (denoted by $S$) and try to match the current edge. Our goal is to maximize the expected size of the output set $A$.

We use ESD for the following reasons.
\begin{enumerate}
	\item The solution of ESP has a size of $O(|E|)$, which equals to the size of input. The executor of the matching only needs to use O(1) computation for each prob. These two properties make the solution perfect to be used as handouts. In other words, the order can be generated by a computer and any people can execute the matching without a computer.
	This property makes ESP quite practical. For example, when matching roommates among a class of students, the teacher can input a graph showing the compatibilities between students and an estimated acceptance ratio into the program. The program outputs an order of probs. The teacher can just follow the order to query pairs of students. 
	\item The optimal solution can be solved by Optimization 1 in small graphs and can be approximated in larger graphs.
\end{enumerate}

In Algorithm \ref{alg:esd}, The generating of array $S$ is not mentioned.
Even though we find the $S$ that can maximize the expected size of $A$, the current matching policy may not be optimal.
However, ESD has the following advantages that motivates us to find a good policy based on it.

The most important advantage is that given $S$ the expected size of $A$ can be solved. It is not natural for other policies for optimizing stochastic matching. The expected cardinality of the matching can be solved as follows.
\begin{equation}
E_S(|A|)=2\sum_{i=1}^m p*\prod_{j=1}^{i-1}(1-p)^{\delta(s_i,s_j)}
\end{equation}

$\delta(s_i,s_j)$ is an indicator, which equals to 1 if $s_i$ and $s_j$ are disjoint, otherwise equals to 0.

\subsection{Optimizing the order}
A natural question is how to decide $S$ to maximize cardinality.
The most straightforward way is by enumerating all the permutations and find one permutation with the best payoff (the expected number of matched agents).
In this way, the computational complexity is $O(|E|!*|E|^2)$.
It can only handle a graph with up to 12 or 13 edges.

To solve the optimal order of edges for lager graphs, we model it as an integer linear program (ILP).
With the ILP we proposed, we can easily handle a graph with more than 20 edges.
For larger cases, we can approximate the optimal payoff by restricting the maximum iteration of the ILP.

The ILP problem is listed as Optimization 1.
Renumber all the elements in $E$ as $e_1,e_2,\ldots,e_m$.

 $x_{ij}$ is the indicator for whether $s_i$ is the $j$-th edge in .

\begin{equation}
	\begin{aligned}
	\text{\textbf{Optimization 1}}\\
	\text{Maximize}p_i
	\end{aligned}
\end{equation}



\newpage
\bibliographystyle{named}
\bibliography{matching}

\end{document}


